# 演奏功能使用说明

## 功能概述

"我要演奏"功能允许用户为原创音乐作品上传自己的演奏或演唱录音，实现音乐创作的二次演绎和社区互动。

## 主要功能

### 1. 上传演奏

- **入口**：在作品详情页面点击"上传演奏"或"上传我的演奏"按钮
- **支持格式**：MP3、WAV 等音频格式
- **文件大小**：最大 50MB
- **必填信息**：
  - 演奏标题
  - 演奏类型（器乐/声乐）
  - 乐器/声部
  - 音频文件
- **可选信息**：
  - 演奏描述
  - 公开设置

### 2. 演奏列表

- **展示位置**：作品详情页面的演奏区域
- **功能特性**：
  - 播放/暂停控制
  - 点赞功能
  - 演奏者信息
  - 统计信息（点赞数、评论数、播放次数）
  - 点击标题跳转到演奏详情页

### 3. 演奏详情页

- **访问方式**：点击演奏标题或直接访问 `/performances/[id]`
- **功能特性**：
  - 完整演奏信息展示
  - 音频播放控制
  - 点赞功能
  - 原作品信息
  - 编辑/删除（仅演奏者本人）

### 4. 演奏编辑

- **访问方式**：演奏详情页面的"编辑"按钮
- **可编辑内容**：
  - 演奏标题
  - 演奏描述
  - 演奏类型
  - 乐器/声部
  - 公开设置
- **不可编辑**：音频文件（需重新上传）

### 5. 演奏列表页

- **访问方式**：导航菜单中的"演奏列表"
- **功能特性**：
  - 所有演奏的列表展示
  - 筛选功能（类型、作品 ID、演奏者 ID）
  - 搜索功能
  - 分页展示

## 技术实现

### 数据库表结构

- `performances` - 演奏主表
- `performance_likes` - 演奏点赞表

### API 接口

- `POST /api/performances` - 创建演奏
- `GET /api/performances` - 获取演奏列表
- `GET /api/performances/[id]` - 获取演奏详情
- `PUT /api/performances/[id]` - 更新演奏
- `DELETE /api/performances/[id]` - 删除演奏
- `POST /api/performances/[id]/like` - 点赞演奏
- `DELETE /api/performances/[id]/like` - 取消点赞

### 页面路由

- `/performances/new` - 上传演奏页面
- `/performances/[id]` - 演奏详情页面
- `/performances/[id]/edit` - 演奏编辑页面
- `/performances` - 演奏列表页面

## 使用流程

### 上传演奏流程

1. 在作品详情页面点击"上传演奏"
2. 填写演奏信息（标题、类型、乐器等）
3. 选择音频文件
4. 设置公开选项
5. 提交上传

### 演奏管理流程

1. 在演奏详情页面可以播放、点赞
2. 演奏者本人可以编辑和删除
3. 在演奏列表页面可以浏览所有演奏

## 注意事项

1. **权限控制**：只有登录用户才能上传演奏
2. **文件限制**：音频文件最大 50MB，支持 MP3、WAV 格式
3. **数据关联**：演奏必须关联到具体的作品
4. **统计更新**：点赞、播放等操作会自动更新相关统计数据
5. **删除影响**：删除演奏会同时更新作品的演奏数量统计

## 扩展功能

### 已实现

- 基础演奏上传和管理
- 播放控制
- 点赞系统
- 筛选和搜索

### 待实现

- 评论系统
- 播放列表
- 音频波形显示
- 演奏评分系统
- 协作演奏功能

## 测试建议

1. **功能测试**：

   - 上传不同格式和大小的音频文件
   - 测试播放、暂停、点赞等交互功能
   - 验证权限控制（编辑、删除）

2. **性能测试**：

   - 大量演奏数据的加载性能
   - 音频文件上传的稳定性
   - 并发访问的处理能力

3. **用户体验测试**：
   - 界面响应速度
   - 错误提示的友好性
   - 移动端适配效果
