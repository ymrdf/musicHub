# Star 功能使用说明

## 概述

Star 功能是 MusicHub 平台的核心功能之一，类似于 GitHub 的 star 功能，允许用户收藏自己喜欢的原创音乐作品。这个功能帮助用户发现优质音乐，同时也为创作者提供了作品受欢迎程度的参考标准。

## 功能特性

### 1. 作品收藏

- 用户可以收藏任何公开的原创音乐作品
- 收藏的作品会显示在用户的个人收藏列表中
- 每个作品显示总收藏数量
- 用户不能收藏自己的作品

### 2. 热门榜单

- 基于收藏数量生成热门作品榜单
- 支持按时间周期筛选（日榜、周榜、月榜）
- 同时展示作品和演奏，按热度排序
- 实时更新收藏数和播放数

### 3. 发现页面增强

- 在发现页面同时展示作品和演奏
- 作品支持收藏功能，演奏支持点赞功能
- 按收藏数、点赞数、播放数等多种方式排序

## 使用方法

### 收藏作品

1. **在作品详情页面**

   - 点击作品页面右上角的"收藏"按钮
   - 收藏成功后按钮变为"已收藏"状态
   - 收藏数实时更新

2. **在发现页面**

   - 浏览作品列表
   - 点击作品卡片上的"收藏"按钮
   - 支持批量收藏操作

3. **在热门榜单页面**
   - 查看按热度排序的作品
   - 直接收藏热门作品
   - 按时间周期筛选内容

### 取消收藏

- 在已收藏的作品上点击"已收藏"按钮
- 确认取消收藏操作
- 收藏数相应减少

## 技术实现

### 后端 API

#### 收藏作品

```http
POST /api/works/{id}/star
Authorization: Bearer {token}
```

#### 取消收藏

```http
DELETE /api/works/{id}/star
Authorization: Bearer {token}
```

#### 获取热门榜单

```http
GET /api/trending?type={type}&timePeriod={period}
```

参数说明：

- `type`: 内容类型 (`all`, `work`, `performance`)
- `timePeriod`: 时间周期 (`daily`, `weekly`, `monthly`)

### 数据库结构

```sql
-- 作品收藏表
CREATE TABLE work_stars (
    id INT AUTO_INCREMENT PRIMARY KEY,
    work_id INT NOT NULL COMMENT '作品ID',
    user_id INT NOT NULL COMMENT '用户ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '收藏时间',

    FOREIGN KEY (work_id) REFERENCES works(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY unique_work_star (work_id, user_id)
);
```

### 前端组件

- **作品详情页面**: 显示收藏状态和收藏数
- **发现页面**: 支持作品收藏和演奏点赞
- **热门榜单页面**: 按热度排序展示内容
- **Header 导航**: 快速访问热门榜单

## 排序算法

### 热度计算

- **作品**: 主要按收藏数排序，其次按浏览量排序
- **演奏**: 主要按点赞数排序，其次按播放数排序
- **混合排序**: 统一按热度分数排序

### 时间筛选

- **日榜**: 当天创建的内容
- **周榜**: 本周创建的内容
- **月榜**: 本月创建的内容

## 用户体验

### 视觉反馈

- 收藏按钮使用黄色主题，突出重要性
- 已收藏状态显示实心星星图标
- 收藏数实时更新，提供即时反馈

### 交互设计

- 一键收藏/取消收藏
- 防止重复收藏
- 支持批量操作
- 响应式设计，移动端友好

## 性能优化

### 数据库优化

- 使用索引优化查询性能
- 收藏数缓存，减少实时计算
- 分页加载，支持大量数据

### 前端优化

- 状态管理，避免重复请求
- 懒加载，提升页面性能
- 缓存机制，减少 API 调用

## 安全考虑

### 权限控制

- 只有登录用户才能收藏
- 用户不能收藏自己的作品
- 作品必须为公开状态

### 数据验证

- 验证作品 ID 有效性
- 防止重复收藏
- 事务处理确保数据一致性

## 测试

### 功能测试

```bash
# 运行测试脚本
node scripts/test-star.js
```

### 测试覆盖

- 收藏/取消收藏功能
- 权限验证
- 数据一致性
- API 响应格式
- 错误处理

## 未来扩展

### 功能增强

- 收藏分类管理
- 收藏推荐算法
- 收藏历史记录
- 批量收藏操作

### 数据分析

- 收藏趋势分析
- 用户偏好分析
- 热门内容预测
- 创作者影响力评估

## 常见问题

### Q: 为什么不能收藏自己的作品？

A: 这是设计上的考虑，避免自我收藏影响数据真实性。

### Q: 收藏数多久更新一次？

A: 收藏数实时更新，无需等待。

### Q: 可以取消收藏吗？

A: 可以，点击已收藏按钮即可取消。

### Q: 热门榜单多久更新一次？

A: 热门榜单实时计算，基于最新的收藏和播放数据。

## 联系支持

如果您在使用 Star 功能时遇到问题，请：

1. 检查网络连接
2. 确认用户登录状态
3. 查看浏览器控制台错误信息
4. 联系技术支持团队
